<?xml version="1.0"?>
<robot name="crustcrawler_arm" xmlns:xacro="http://www.ros.org/wiki/xacro">
    
    <xacro:include filename="$(find crustcrawler_description)/urdf/materials.urdf.xacro" />
    <!--xacro:macro name="crustcrawler_arm"-->
        <link name="world"/>
        <!-- ****** JOINT DEFINITIONS ****** -->    
        <!-- Arm's base joint -->
        <joint name="arm_base_joint" type="fixed">
            <origin xyz="0 0 0" rpy="0 0 0" /> 
            <parent link="world"/>
            <child link="link_joint_1"/>
        </joint>   
        
        <!-- joint 1 -->
        <joint name="joint_1" type="revolute" >
            <origin xyz="0 0 0.055" rpy="0 0 0" />
            <parent link="link_joint_1" />
            <child link="link_joint_2"/>
            
            <axis xyz="0 0 1"/>
            <limit  lower="-1.8" upper="2.3" effort="300" velocity="1.17" />
            <safety_controller k_position="100" k_velocity="15.0" soft_lower_limit="${-1.22+0.1}" soft_upper_limit="${1.22-0.1}" />
            <dynamics damping="50" friction="1"/>
        </joint>

        <!-- joint 2 -->
        <joint name="joint_2" type="revolute" >
            <origin xyz="0 -0.06 0.06" rpy="0 0 0" />
            <parent link="link_joint_2" />
            <child link="connector_1"/>
            
            <axis xyz="0 1 0"/>
            <limit  lower="-1.6" upper="1.6" effort="300" velocity="1.17" />
            <safety_controller k_position="100" k_velocity="15.0" soft_lower_limit="${-1.22+0.1}" soft_upper_limit="${1.22-0.1}" />
            <dynamics damping="50" friction="1"/>
        </joint>

        <!-- Fixed joint between connector_1 and the first girder -->
        <joint name="connector_1_girder_1_joint" type="fixed">
            <origin xyz="0 0 0.036" rpy="0 0 0" />
            <parent link="connector_1"/>
            <child link="link_girder_1"/>
        </joint>

        <!-- Fixed joint between first girder joint_3 -->
        <joint name="girder_1_joint_3_joint" type="fixed">
            <origin xyz="0 0 0.127" rpy="0 0 0" />
            <parent link="link_girder_1"/>
            <child link="link_joint_3"/>
        </joint>


        <!-- joint 3 -->
        <joint name="joint_3" type="revolute" >
            <origin xyz="0 0 0.06" rpy="0 0 0" />
            <parent link="link_joint_3" />
            <child link="connector_2"/>
            
            <axis xyz="0 1 0"/>
            <limit  lower="-1.6" upper="1.6" effort="300" velocity="1.17" />
            <safety_controller k_position="100" k_velocity="15.0" soft_lower_limit="${-1.22+0.1}" soft_upper_limit="${1.22-0.1}" />
            <dynamics damping="50" friction="1"/>
        </joint>

        <!-- Fixed joint between connector_2 and link_girder_2 -->
        <joint name="connector_2_girder_2_joint" type="fixed">
            <origin xyz="0 0 0.036" rpy="0 0 0" />
            <parent link="connector_2"/>
            <child link="link_girder_2"/>
        </joint>

        <!-- Fixed joint between second girder joint_4 -->
        <joint name="girder_2_joint_4_joint" type="fixed">
            <origin xyz="0 0 0.0635" rpy="0 0 0" />
            <parent link="link_girder_2"/>
            <child link="link_joint_4"/>
        </joint>

        <!-- joint 4 -->
        <joint name="joint_4" type="revolute" >
            <origin xyz="0 0 0.06" rpy="0 0 0" />
            <parent link="link_joint_4" />
            <child link="link_joint_5"/>
            
            <axis xyz="0 0 1"/>
            <limit  lower="-1.6" upper="1.6" effort="300" velocity="1.17" />
            <safety_controller k_position="100" k_velocity="15.0" soft_lower_limit="${-1.22+0.1}" soft_upper_limit="${1.22-0.1}" />
            <dynamics damping="50" friction="1"/>
        </joint>

        <!-- joint 5 -->
        <joint name="joint_5" type="revolute" >
            <origin xyz="0 -0.024 0.044" rpy="0 0 0" />
            <parent link="link_joint_5" />
            <child link="connector_3"/>
            
            <axis xyz="0 1 0"/>
            <limit  lower="-1.6" upper="1.6" effort="300" velocity="1.17" />
            <safety_controller k_position="100" k_velocity="15.0" soft_lower_limit="${-1.22+0.1}" soft_upper_limit="${1.22-0.1}" />
            <dynamics damping="50" friction="1"/>
        </joint>

        <!-- Fixed joint between connector_3 and joint_6 -->
        <joint name="connector_3_joint_6_joint" type="fixed">
            <origin xyz="0 0 0.0305" rpy="0 0 0" />
            <parent link="connector_3"/>
            <child link="link_joint_6"/>
        </joint>

        <!-- joint 6 -->
        <joint name="joint_6" type="revolute" >
            <origin xyz="0 0 0.053" rpy="0 0 0" />
            <parent link="link_joint_6" />
            <child link="link_gripper_base"/>
            
            <axis xyz="0 0 1"/>
            <limit  lower="-1.6" upper="1.6" effort="300" velocity="1.17" />
            <safety_controller k_position="100" k_velocity="15.0" soft_lower_limit="${-1.22+0.1}" soft_upper_limit="${1.22-0.1}" />
            <dynamics damping="50" friction="1"/>
        </joint>

        <!-- Gripper right finger joint -->
        <joint name="right_finger_joint" type="revolute">
            <origin xyz="0.02 -0.02 0.04" rpy="0 0 0" />
            <parent link="link_gripper_base"/>
            <child link="link_right_finger" />
            
            <axis xyz="0 0 1"/>
            <!-- From 14 to -45 degrees -->
            <limit  lower="-0.838576116" upper="0.245436912" effort="300" velocity="1.17" />
            <dynamics damping="50" friction="1"/>
            <safety_controller k_position="100" k_velocity="15.0" soft_lower_limit="${-0.838576116+0.1}" soft_upper_limit="${0.245436912-0.1}" />
        </joint>
        
        <!-- Gripper left finger joint -->
        <joint name="left_finger_joint" type="revolute">
            <origin xyz="0.02 0.02 0.04" rpy="0 0 0" />
            <parent link="link_gripper_base"/>
            <child link="link_left_finger" />
            
            <axis xyz="0 0 1"/>
            <!-- From 14 to -45 degrees -->
            <limit  lower="-0.838576116" upper="0.245436912" effort="300" velocity="1.17" />
            <dynamics damping="50" friction="1"/>
            <safety_controller k_position="100" k_velocity="15.0" soft_lower_limit="${-0.838576116+0.1}" soft_upper_limit="${0.245436912-0.1}" />
        </joint>


        <!-- ****** LINK DEFINITIONS ****** -->      
        <link name="link_joint_1">
            <inertial>
                <mass value="0.125" />
                <origin xyz="0 0 0.00893364" rpy="0 0 0" />
                <inertia ixx="1.0" ixy="0.0" ixz="0.0"
                         iyy="1.0" iyz="0.0" 
                         izz="1.0" />
            </inertial>
            
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/joint_1.dae"/>
                </geometry>
                <material name="Green" />
            </visual>
            
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/joint_1.dae"/>
                </geometry>
            </collision>
        </link>

        <link name="link_joint_2">
            <inertial>
                <mass value="0.425" />
                <origin xyz="0.000006 -0.180636 0.145305" rpy="0 0 0" />
                <inertia ixx="-0.000007" ixy="0.0" ixz="0.0"
                         iyy="-0.000003" iyz="-0.000003" 
                         izz="-0.000004" />
            </inertial>
            
            <visual>
                <origin xyz="0 0 0.055" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/joint_2.dae"/>
                </geometry>
                <material name="Grey" />
            </visual>
            
            <collision>
                <origin xyz="0 0 0.055" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/joint_2.dae"/>
                </geometry>
            </collision>
        </link>

        <link name="connector_1">
            <inertial>
                <mass value="0.05" />
                <origin xyz="0 0 0.02" rpy="0 0 0" />
                <inertia ixx="0.0" ixy="0.0" ixz="0.0"
                         iyy="0.0" iyz="0.0" 
                         izz="0.0" />
            </inertial>
            
            <visual>
                <origin xyz="0 0 0.115" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/connecter_joint_2_girder_1.dae"/>
                </geometry>
                <material name="Blue" />
            </visual>
            
            <collision>
                <origin xyz="0 0 0.115" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/connecter_joint_2_girder_1.dae"/>
                </geometry>
            </collision>
        </link>

        <link name="link_girder_1">
            <inertial>
                <mass value="0.037" />
                <origin xyz="0 0 0.06" rpy="0 0 0" />
                <inertia ixx="0.0" ixy="0.0" ixz="0.0"
                         iyy="0.0" iyz="0.0" 
                         izz="0.0" />
            </inertial>
            
            <visual>
                <origin xyz="-0.0153 0 0.118" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/link_50.dae"/>
                </geometry>
                <material name="Green" />
            </visual>
            
            <collision>
                <origin xyz="-0.0153 0 0.118" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/link_50.dae"/>
                </geometry>
            </collision>
        </link>

        <link name="link_joint_3">
            <inertial>
                <mass value="0.195612" />
                <origin xyz="0.000143 -0.02 0.0025" rpy="0 0 0" />
                <inertia ixx="-0.000007" ixy="0.0" ixz="0.0"
                         iyy="-0.000003" iyz="-0.000003" 
                         izz="-0.000004" />
            </inertial>
            
            <visual>
                <origin xyz="0 0 0.118" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/joint_3.dae"/>
                </geometry>
                <material name="Grey" />
            </visual>
            
            <collision>
                <origin xyz="0 0 0.118" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/joint_3.dae"/>
                </geometry>
            </collision>
        </link>

        <link name="connector_2">
            <inertial>
                <mass value="0.05" />
                <origin xyz="0 0 0.02" rpy="0 0 0" />
                <inertia ixx="0.0" ixy="0.0" ixz="0.0"
                         iyy="0.0" iyz="0.0" 
                         izz="0.0" />
            </inertial>
            
            <visual>
                <origin xyz="0 0 0.34" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/connecter_joint_3_girder_2.dae"/>
                </geometry>
                <material name="Blue" />
            </visual>
            
            <collision>
                <origin xyz="0 0 0.34" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/connecter_joint_3_girder_2.dae"/>
                </geometry>
            </collision>
        </link>

        <link name="link_girder_2">
            <inertial>
                <mass value="0.037" />
                <origin xyz="0 0 0.06" rpy="0 0 0" />
                <inertia ixx="0.0" ixy="0.0" ixz="0.0"
                         iyy="0.0" iyz="0.0" 
                         izz="0.0" />
            </inertial>
            
            <visual>
                <origin xyz="-0.0153 0 0.341" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/link_25.dae"/>
                </geometry>
                <material name="Green" />
            </visual>
            
            <collision>
                <origin xyz="-0.0153 0 0.341" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/link_25.dae"/>
                </geometry>
            </collision>
        </link>

        <link name="link_joint_4">
            <inertial>
                <mass value="0.187107" />
                <origin xyz="0.000006 -0.180636 0.145305" rpy="0 0 0" />
                <inertia ixx="-0.000007" ixy="0.0" ixz="0.0"
                         iyy="-0.000003" iyz="-0.000003" 
                         izz="-0.000004" />
            </inertial>
            
            <visual>
                <origin xyz="0 0 0.34" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/joint_4.dae"/>
                </geometry>
                <material name="Grey" />
            </visual>
            
            <collision>
                <origin xyz="0 0 0.34" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/joint_4.dae"/>
                </geometry>
            </collision>
        </link>
        
        <link name="link_joint_5">
            <inertial>
                <mass value="0.0963884" />
                <origin xyz="0.000006 -0.180636 0.145305" rpy="0 0 0" />
                <inertia ixx="-0.000007" ixy="0.0" ixz="0.0"
                         iyy="-0.000003" iyz="-0.000003" 
                         izz="-0.000004" />
            </inertial>
            
            <visual>
                <origin xyz="0 0 0.5" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/joint_5.dae"/>
                </geometry>
                <material name="Grey" />
            </visual>
            
            <collision>
                <origin xyz="0 0 0.5" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/joint_5.dae"/>
                </geometry>
            </collision>
        </link>

        <link name="connector_3">
            <inertial>
                <mass value="0.05" />
                <origin xyz="0 0 0.02" rpy="0 0 0" />
                <inertia ixx="0.0" ixy="0.0" ixz="0.0"
                         iyy="0.0" iyz="0.0" 
                         izz="0.0" />
            </inertial>
            
            <visual>
                <origin xyz="0 0 0.542" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/connecter_joint_5_joint_6.dae"/>
                </geometry>
                <material name="Blue" />
            </visual>
            
            <collision>
                <origin xyz="0 0 0.542" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/connecter_joint_5_joint_6.dae"/>
                </geometry>
            </collision>
        </link>
        
        <link name="link_joint_6">
            <inertial>
                <mass value="0.0963884" />
                <origin xyz="0.000006 -0.180636 0.145305" rpy="0 0 0" />
                <inertia ixx="-0.000007" ixy="0.0" ixz="0.0"
                         iyy="-0.000003" iyz="-0.000003" 
                         izz="-0.000004" />
            </inertial>
            
            <visual>
                <origin xyz="0 0 0.565" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/joint_6.dae"/>
                </geometry>
                <material name="Grey" />
            </visual>
            
            <collision>
                <origin xyz="0 0 0.565" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/joint_6.dae"/>
                </geometry>
            </collision>
        </link>

        <link name="link_gripper_base">
            <inertial>
                <mass value="0.425" />
                <origin xyz="0.000006 -0.180636 0.145305" rpy="0 0 0" />
                <inertia ixx="-0.000007" ixy="0.0" ixz="0.0"
                         iyy="-0.000003" iyz="-0.000003" 
                         izz="-0.000004" />
            </inertial>
            
            <visual>
                <origin xyz="0 0 0.627" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/gripper_base.dae"/>
                </geometry>
                <material name="Grey" />
            </visual>
            
            <collision>
                <origin xyz="0 0 0.627" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/gripper_base.dae"/>
                </geometry>
            </collision>
        </link>

        <link name="link_right_finger">
            <inertial>
                <mass value="0.425" />
                <origin xyz="0.000006 -0.180636 0.145305" rpy="0 0 0" />
                <inertia ixx="-0.000007" ixy="0.0" ixz="0.0"
                         iyy="-0.000003" iyz="-0.000003" 
                         izz="-0.000004" />
            </inertial>
            
            <visual>
                <origin xyz="0 -0.018 0.668" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/arm_right_finger.dae"/>
                </geometry>
                <material name="Grey" />
            </visual>
            
            <collision>
                <origin xyz="0 -0.018 0.668" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/arm_right_finger.dae"/>
                </geometry>
            </collision>
        </link>

        <link name="link_left_finger">
            <inertial>
                <mass value="0.425" />
                <origin xyz="0.000006 -0.180636 0.145305" rpy="0 0 0" />
                <inertia ixx="-0.000007" ixy="0.0" ixz="0.0"
                         iyy="-0.000003" iyz="-0.000003" 
                         izz="-0.000004" />
            </inertial>
            
            <visual>
                <origin xyz="0 0.018 0.668" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/arm_left_finger.dae"/>
                </geometry>
                <material name="Grey" />
            </visual>
            
            <collision>
                <origin xyz="0 0.018 0.668" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://crustcrawler_description/meshes/collada/arm_left_finger.dae"/>
                </geometry>
            </collision>
        </link>

        <!-- ****** TRANSMISSION DEFINITIONS ****** -->
        <transmission type="pr2_mechanism_model/SimpleTransmission" name="joint_1_trans">
            <actuator name="joint_1_motor" />
            <joint name="joint_1" />
            <mechanicalReduction>1.0</mechanicalReduction>
        </transmission>

        <transmission type="pr2_mechanism_model/SimpleTransmission" name="joint_2_trans">
            <actuator name="joint_2_motor" />
            <joint name="joint_2" />
            <mechanicalReduction>1.0</mechanicalReduction>
        </transmission>

        <transmission type="pr2_mechanism_model/SimpleTransmission" name="joint_3_trans">
            <actuator name="joint_3_motor" />
            <joint name="joint_3" />
            <mechanicalReduction>1.0</mechanicalReduction>
        </transmission>

        <transmission type="pr2_mechanism_model/SimpleTransmission" name="joint_4_trans">
            <actuator name="joint_4_motor" />
            <joint name="joint_4" />
            <mechanicalReduction>1.0</mechanicalReduction>
        </transmission>

        <transmission type="pr2_mechanism_model/SimpleTransmission" name="joint_5_trans">
            <actuator name="joint_5_motor" />
            <joint name="joint_5" />
            <mechanicalReduction>1.0</mechanicalReduction>
        </transmission>

        <transmission type="pr2_mechanism_model/SimpleTransmission" name="joint_6_trans">
            <actuator name="joint_6_motor" />
            <joint name="joint_6" />
            <mechanicalReduction>1.0</mechanicalReduction>
        </transmission>

        <transmission type="pr2_mechanism_model/SimpleTransmission" name="right_finger_joint_trans">
            <actuator name="right_finger_joint_motor" />
            <joint name="right_finger_joint" />
            <mechanicalReduction>1.0</mechanicalReduction>
        </transmission>

        <transmission type="pr2_mechanism_model/SimpleTransmission" name="left_finger_joint_trans">
            <actuator name="left_finger_joint_motor" />
            <joint name="left_finger_joint" />
            <mechanicalReduction>1.0</mechanicalReduction>
        </transmission>
        
        <!-- ****** MATERIAL DEFINITIONS ****** -->
        <gazebo reference="link_joint_1">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>
        
        <gazebo reference="link_joint_2">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>

        <gazebo reference="connector_1">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>

        <gazebo reference="link_girder_1">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>

        <gazebo reference="link_joint_3">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>

        <gazebo reference="connector_2">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>

        <gazebo reference="link_girder_2">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>

        <gazebo reference="link_joint_4">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>

        <gazebo reference="link_joint_5">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>

        <gazebo reference="connector_3">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>

        <gazebo reference="link_joint_6">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>

        <gazebo reference="link_gripper_base">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>

        <gazebo reference="link_right_finger">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>

        <gazebo reference="link_left_finger">
            <material>SmartArm/GunMetalBrushedAluminum</material>
            <turnGravityOff>false</turnGravityOff>
        </gazebo>


        <!-- ****** CONTROLLERS DEFINITIONS ****** -->
        <gazebo reference="joint_1">
            <stopKd value="1.0" />
            <stopKp value="1000000.0" />
            <fudgeFactor value="0.5" />
        </gazebo>
 
        <gazebo reference="joint_2">
            <stopKd value="1.0" />
            <stopKp value="1000000.0" />
            <fudgeFactor value="0.5" />
        </gazebo>

        <gazebo reference="joint_3">
            <stopKd value="1.0" />
            <stopKp value="1000000.0" />
            <fudgeFactor value="0.5" />
        </gazebo>

        <gazebo reference="joint_4">
            <stopKd value="1.0" />
            <stopKp value="1000000.0" />
            <fudgeFactor value="0.5" />
        </gazebo>

        <gazebo reference="joint_5">
            <stopKd value="1.0" />
            <stopKp value="1000000.0" />
            <fudgeFactor value="0.5" />
        </gazebo>

        <gazebo reference="joint_6">
            <stopKd value="1.0" />
            <stopKp value="1000000.0" />
            <fudgeFactor value="0.5" />
        </gazebo>

        <gazebo reference="right_finger_joint">
            <stopKd value="1.0" />
            <stopKp value="1000000.0" />
            <fudgeFactor value="0.5" />
        </gazebo>

        <gazebo reference="left_finger_joint">
            <stopKd value="1.0" />
            <stopKp value="1000000.0" />
            <fudgeFactor value="0.5" />
        </gazebo>

    <!--/xacro:macro-->
</robot>
